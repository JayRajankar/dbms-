<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Management Systems - Complete Reference Guide</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.4.0/css/all.min.css">
    <style>
        .code-block {
            background-color: #1e293b;
            color: #e2e8f0;
            padding: 1rem;
            border-radius: 0.5rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.5;
            overflow-x: auto;
            white-space: pre-wrap;
        }
        .section-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin: 2rem 0 1rem 0;
        }
        .subsection {
            border-left: 4px solid #667eea;
            padding-left: 1rem;
            margin: 1rem 0;
        }
        .concept-box {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 0.5rem;
            padding: 1rem;
            margin: 1rem 0;
        }
        .highlight {
            background-color: #fef3c7;
            padding: 0.25rem;
            border-radius: 0.25rem;
        }
        .nav-link {
            display: block;
            padding: 0.5rem 1rem;
            color: #4f46e5;
            text-decoration: none;
            border-radius: 0.25rem;
            transition: background-color 0.2s;
        }
        .nav-link:hover {
            background-color: #e0e7ff;
        }
        @media print {
            .no-print { display: none; }
            body { font-size: 12px; }
            .code-block { font-size: 10px; }
        }
    </style>
</head>
<body class="bg-gray-50 text-gray-900">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-4xl font-bold text-gray-800 mb-4">
                <i class="fas fa-database text-blue-600 mr-3"></i>
                Database Management Systems
            </h1>
            <p class="text-xl text-gray-600">Complete Reference Guide</p>
            <p class="text-sm text-gray-500 mt-2">SQL DDL/DML • PL/SQL Procedures • MongoDB • Database Design</p>
        </div>

        <!-- Table of Contents -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8 no-print">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">
                <i class="fas fa-list mr-2"></i>Table of Contents
            </h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <a href="#database-design" class="nav-link"><i class="fas fa-sitemap mr-2"></i>1. Database Design & ER Diagrams</a>
                    <a href="#sql-ddl" class="nav-link"><i class="fas fa-hammer mr-2"></i>2. SQL DDL Operations</a>
                    <a href="#sql-dml" class="nav-link"><i class="fas fa-edit mr-2"></i>3. SQL DML Operations</a>
                    <a href="#plsql" class="nav-link"><i class="fas fa-code mr-2"></i>4. PL/SQL Procedures</a>
                </div>
                <div>
                    <a href="#triggers" class="nav-link"><i class="fas fa-bolt mr-2"></i>5. Database Triggers</a>
                    <a href="#mongodb" class="nav-link"><i class="fas fa-leaf mr-2"></i>6. MongoDB Operations</a>
                    <a href="#best-practices" class="nav-link"><i class="fas fa-star mr-2"></i>7. Best Practices</a>
                    <a href="#summary" class="nav-link"><i class="fas fa-clipboard-check mr-2"></i>8. Summary</a>
                </div>
            </div>
        </div>

        <!-- Section 1: Database Design & ER Diagrams -->
        <section id="database-design">
            <div class="section-header">
                <h2 class="text-3xl font-bold"><i class="fas fa-sitemap mr-3"></i>1. Database Design & ER Diagrams</h2>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">1.1 Banking System ER Design</h3>
                <div class="concept-box">
                    <h4 class="text-lg font-semibold mb-2">Entities and Relationships</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h5 class="font-semibold text-blue-600">Core Entities:</h5>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li><strong>Customer:</strong> cust_id, name, address, phone</li>
                                <li><strong>Account:</strong> acc_no, branch_name, balance, date_opened</li>
                                <li><strong>Branch:</strong> branch_name, city, assets</li>
                                <li><strong>Loan:</strong> loan_no, branch_name, amount</li>
                                <li><strong>Transaction:</strong> trans_id, acc_no, amount, date</li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="font-semibold text-green-600">Relationships:</h5>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li>Customer <em>has</em> Account (1:M)</li>
                                <li>Branch <em>manages</em> Account (1:M)</li>
                                <li>Customer <em>takes</em> Loan (1:M)</li>
                                <li>Account <em>has</em> Transaction (1:M)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">1.2 Company Management ER Design</h3>
                <div class="concept-box">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h5 class="font-semibold text-blue-600">Core Entities:</h5>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li><strong>Employee:</strong> emp_id, fname, lname, ssn, salary, dept_id</li>
                                <li><strong>Department:</strong> dept_id, dept_name, mgr_id, mgr_start_date</li>
                                <li><strong>Project:</strong> proj_id, proj_name, location, dept_id</li>
                                <li><strong>Dependent:</strong> dep_id, emp_id, name, relationship</li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="font-semibold text-green-600">Relationships:</h5>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li>Employee <em>works in</em> Department (M:1)</li>
                                <li>Employee <em>manages</em> Department (1:1)</li>
                                <li>Employee <em>works on</em> Project (M:M)</li>
                                <li>Employee <em>has</em> Dependent (1:M)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">1.3 Library Management ER Design</h3>
                <div class="concept-box">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <h5 class="font-semibold text-blue-600">Core Entities:</h5>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li><strong>Book:</strong> book_id, title, author, publisher_id, price</li>
                                <li><strong>Member:</strong> member_id, name, address, phone</li>
                                <li><strong>Publisher:</strong> publisher_id, name, city</li>
                                <li><strong>Staff:</strong> staff_id, name, designation</li>
                                <li><strong>Borrow:</strong> borrow_id, member_id, book_id, issue_date, return_date</li>
                            </ul>
                        </div>
                        <div>
                            <h5 class="font-semibold text-green-600">Relationships:</h5>
                            <ul class="list-disc list-inside mt-2 space-y-1">
                                <li>Book <em>published by</em> Publisher (M:1)</li>
                                <li>Member <em>borrows</em> Book (M:M via Borrow)</li>
                                <li>Staff <em>manages</em> Borrow (1:M)</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 2: SQL DDL Operations -->
        <section id="sql-ddl">
            <div class="section-header">
                <h2 class="text-3xl font-bold"><i class="fas fa-hammer mr-3"></i>2. SQL DDL (Data Definition Language)</h2>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">2.1 Table Creation with Constraints</h3>
                <div class="concept-box">
                    <h4 class="text-lg font-semibold mb-3">Banking System Tables</h4>
                    <div class="code-block">CREATE DATABASE BankingSystem;
USE BankingSystem;

-- Customer Table
CREATE TABLE Customer (
    cust_id INT PRIMARY KEY AUTO_INCREMENT,
    cust_name VARCHAR(100) NOT NULL,
    cust_address VARCHAR(200),
    cust_phone VARCHAR(15) UNIQUE,
    cust_email VARCHAR(100) UNIQUE,
    date_joined DATE DEFAULT CURRENT_DATE
);

-- Branch Table
CREATE TABLE Branch (
    branch_name VARCHAR(50) PRIMARY KEY,
    branch_city VARCHAR(50) NOT NULL,
    assets DECIMAL(15,2) CHECK (assets >= 0),
    established_date DATE
);

-- Account Table
CREATE TABLE Account (
    acc_no INT PRIMARY KEY AUTO_INCREMENT,
    branch_name VARCHAR(50) NOT NULL,
    balance DECIMAL(12,2) DEFAULT 0 CHECK (balance >= 0),
    acc_type ENUM('Savings', 'Current', 'Fixed') DEFAULT 'Savings',
    date_opened DATE DEFAULT CURRENT_DATE,
    FOREIGN KEY (branch_name) REFERENCES Branch(branch_name)
        ON DELETE CASCADE ON UPDATE CASCADE
);

-- Depositor Table (Customer-Account relationship)
CREATE TABLE Depositor (
    cust_id INT,
    acc_no INT,
    deposit_date DATE DEFAULT CURRENT_DATE,
    PRIMARY KEY (cust_id, acc_no),
    FOREIGN KEY (cust_id) REFERENCES Customer(cust_id)
        ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (acc_no) REFERENCES Account(acc_no)
        ON DELETE CASCADE ON UPDATE CASCADE
);

-- Loan Table
CREATE TABLE Loan (
    loan_no INT PRIMARY KEY AUTO_INCREMENT,
    branch_name VARCHAR(50) NOT NULL,
    amount DECIMAL(12,2) CHECK (amount > 0),
    interest_rate DECIMAL(5,2) DEFAULT 8.5,
    loan_date DATE DEFAULT CURRENT_DATE,
    FOREIGN KEY (branch_name) REFERENCES Branch(branch_name)
        ON DELETE CASCADE ON UPDATE CASCADE
);

-- Borrower Table (Customer-Loan relationship)
CREATE TABLE Borrower (
    cust_id INT,
    loan_no INT,
    borrow_date DATE DEFAULT CURRENT_DATE,
    PRIMARY KEY (cust_id, loan_no),
    FOREIGN KEY (cust_id) REFERENCES Customer(cust_id)
        ON DELETE CASCADE ON UPDATE CASCADE,
    FOREIGN KEY (loan_no) REFERENCES Loan(loan_no)
        ON DELETE CASCADE ON UPDATE CASCADE
);</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">2.2 Indexes for Performance Optimization</h3>
                <div class="concept-box">
                    <h4 class="text-lg font-semibold mb-3">Creating Indexes</h4>
                    <div class="code-block">-- Single column indexes
CREATE INDEX idx_customer_name ON Customer(cust_name);
CREATE INDEX idx_account_balance ON Account(balance);
CREATE INDEX idx_loan_amount ON Loan(amount);

-- Composite indexes
CREATE INDEX idx_customer_city_name ON Customer(cust_address, cust_name);
CREATE INDEX idx_account_branch_type ON Account(branch_name, acc_type);

-- Unique indexes
CREATE UNIQUE INDEX idx_customer_email ON Customer(cust_email);
CREATE UNIQUE INDEX idx_customer_phone ON Customer(cust_phone);

-- Specialized indexes
CREATE INDEX idx_loan_date_desc ON Loan(loan_date DESC);
CREATE INDEX idx_account_opened_date ON Account(date_opened);</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">2.3 Views for Data Abstraction</h3>
                <div class="concept-box">
                    <h4 class="text-lg font-semibold mb-3">Creating Views</h4>
                    <div class="code-block">-- Customer Account Summary View
CREATE VIEW CustomerAccountSummary AS
SELECT 
    c.cust_id,
    c.cust_name,
    c.cust_address,
    COUNT(d.acc_no) as total_accounts,
    SUM(a.balance) as total_balance,
    MAX(a.date_opened) as latest_account_date
FROM Customer c
LEFT JOIN Depositor d ON c.cust_id = d.cust_id
LEFT JOIN Account a ON d.acc_no = a.acc_no
GROUP BY c.cust_id, c.cust_name, c.cust_address;

-- Branch Performance View
CREATE VIEW BranchPerformance AS
SELECT 
    b.branch_name,
    b.branch_city,
    COUNT(DISTINCT a.acc_no) as total_accounts,
    COUNT(DISTINCT l.loan_no) as total_loans,
    SUM(a.balance) as total_deposits,
    SUM(l.amount) as total_loans_amount,
    b.assets
FROM Branch b
LEFT JOIN Account a ON b.branch_name = a.branch_name
LEFT JOIN Loan l ON b.branch_name = l.branch_name
GROUP BY b.branch_name, b.branch_city, b.assets;

-- Customer Complete Profile View
CREATE VIEW CustomerCompleteProfile AS
SELECT 
    c.cust_id,
    c.cust_name,
    c.cust_address,
    c.cust_phone,
    COALESCE(acc_summary.total_accounts, 0) as accounts_count,
    COALESCE(acc_summary.total_balance, 0) as total_balance,
    COALESCE(loan_summary.total_loans, 0) as loans_count,
    COALESCE(loan_summary.total_loan_amount, 0) as total_loan_amount
FROM Customer c
LEFT JOIN (
    SELECT d.cust_id, COUNT(*) as total_accounts, SUM(a.balance) as total_balance
    FROM Depositor d JOIN Account a ON d.acc_no = a.acc_no
    GROUP BY d.cust_id
) acc_summary ON c.cust_id = acc_summary.cust_id
LEFT JOIN (
    SELECT b.cust_id, COUNT(*) as total_loans, SUM(l.amount) as total_loan_amount
    FROM Borrower b JOIN Loan l ON b.loan_no = l.loan_no
    GROUP BY b.cust_id
) loan_summary ON c.cust_id = loan_summary.cust_id;</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">2.4 Sequences and Auto-Increment</h3>
                <div class="concept-box">
                    <h4 class="text-lg font-semibold mb-3">Creating Sequences</h4>
                    <div class="code-block">-- MySQL Auto-increment with custom starting values
ALTER TABLE Customer AUTO_INCREMENT = 1001;
ALTER TABLE Account AUTO_INCREMENT = 5001;
ALTER TABLE Loan AUTO_INCREMENT = 3001;

-- For databases supporting sequences (PostgreSQL, Oracle)
-- CREATE SEQUENCE customer_id_seq START WITH 1001 INCREMENT BY 1;
-- CREATE SEQUENCE account_no_seq START WITH 5001 INCREMENT BY 1;
-- CREATE SEQUENCE loan_no_seq START WITH 3001 INCREMENT BY 1;

-- Creating custom sequence table for complex numbering
CREATE TABLE NumberSequences (
    sequence_name VARCHAR(50) PRIMARY KEY,
    current_value INT NOT NULL DEFAULT 1,
    increment_by INT NOT NULL DEFAULT 1,
    min_value INT NOT NULL DEFAULT 1,
    max_value BIGINT NOT NULL DEFAULT 9223372036854775807
);

-- Insert initial sequence values
INSERT INTO NumberSequences VALUES 
('CUST_ID', 1001, 1, 1001, 999999),
('ACC_NO', 5001, 1, 5001, 999999999),
('LOAN_NO', 3001, 1, 3001, 999999999);</div>
                </div>
            </div>
        </section>

        <!-- Section 3: SQL DML Operations -->
        <section id="sql-dml">
            <div class="section-header">
                <h2 class="text-3xl font-bold"><i class="fas fa-edit mr-3"></i>3. SQL DML (Data Manipulation Language)</h2>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">3.1 Sample Data Insertion</h3>
                <div class="concept-box">
                    <div class="code-block">-- Insert sample data for comprehensive testing

-- Branch data
INSERT INTO Branch VALUES 
('Akurdi', 'Pune', 50000000.00, '2010-01-15'),
('Nigdi', 'Pune', 35000000.00, '2012-03-20'),
('Karolbagh', 'Delhi', 75000000.00, '2008-06-10'),
('Andheri', 'Mumbai', 90000000.00, '2005-11-25');

-- Customer data
INSERT INTO Customer (cust_name, cust_address, cust_phone, cust_email) VALUES 
('Aarav Sharma', 'Pune', '9876543210', 'aarav@email.com'),
('Priya Patel', 'Mumbai', '9876543211', 'priya@email.com'),
('Sunil Kumar', 'Delhi', '9876543212', 'sunil@email.com'),
('Meera Joshi', 'Pune', '9876543213', 'meera@email.com'),
('Pramod Singh', 'Delhi', '9876543214', 'pramod@email.com'),
('Anil Gupta', 'Mumbai', '9876543215', 'anil@email.com');

-- Account data
INSERT INTO Account (branch_name, balance, acc_type) VALUES 
('Akurdi', 25000.00, 'Savings'),
('Nigdi', 50000.00, 'Current'),
('Karolbagh', 15000.00, 'Savings'),
('Andheri', 75000.00, 'Current'),
('Akurdi', 30000.00, 'Savings'),
('Karolbagh', 45000.00, 'Fixed');

-- Depositor relationships
INSERT INTO Depositor (cust_id, acc_no) VALUES 
(1001, 5001), (1002, 5002), (1003, 5003),
(1004, 5004), (1005, 5005), (1006, 5006);

-- Loan data
INSERT INTO Loan (branch_name, amount, interest_rate) VALUES 
('Akurdi', 200000.00, 9.5),
('Nigdi', 150000.00, 8.5),
('Karolbagh', 300000.00, 10.0),
('Andheri', 250000.00, 9.0);

-- Borrower relationships
INSERT INTO Borrower (cust_id, loan_no) VALUES 
(1001, 3001), (1003, 3002), (1005, 3003), (1006, 3004);</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">3.2 Complex Query Examples</h3>
                <div class="concept-box">
                    <h4 class="text-lg font-semibold mb-3">Join Operations</h4>
                    <div class="code-block">-- 1. Find all customers with their account details (INNER JOIN)
SELECT 
    c.cust_name,
    c.cust_address,
    a.acc_no,
    a.balance,
    a.acc_type,
    b.branch_city
FROM Customer c
INNER JOIN Depositor d ON c.cust_id = d.cust_id
INNER JOIN Account a ON d.acc_no = a.acc_no
INNER JOIN Branch b ON a.branch_name = b.branch_name;

-- 2. Find all customers and their accounts, including those without accounts (LEFT JOIN)
SELECT 
    c.cust_name,
    c.cust_address,
    COALESCE(a.acc_no, 'No Account') as account_number,
    COALESCE(a.balance, 0) as balance
FROM Customer c
LEFT JOIN Depositor d ON c.cust_id = d.cust_id
LEFT JOIN Account a ON d.acc_no = a.acc_no;

-- 3. Find customers who have both accounts and loans
SELECT DISTINCT c.cust_name, c.cust_address
FROM Customer c
INNER JOIN Depositor d ON c.cust_id = d.cust_id
INNER JOIN Borrower b ON c.cust_id = b.cust_id;

-- 4. Find customers with accounts but no loans
SELECT c.cust_name, c.cust_address
FROM Customer c
INNER JOIN Depositor d ON c.cust_id = d.cust_id
WHERE c.cust_id NOT IN (
    SELECT DISTINCT cust_id FROM Borrower WHERE cust_id IS NOT NULL
);</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">3.3 Subqueries and Aggregate Functions</h3>
                <div class="concept-box">
                    <div class="code-block">-- 1. Find customers with above average account balance
SELECT c.cust_name, a.balance
FROM Customer c
JOIN Depositor d ON c.cust_id = d.cust_id
JOIN Account a ON d.acc_no = a.acc_no
WHERE a.balance > (SELECT AVG(balance) FROM Account);

-- 2. Find the branch with maximum total deposits
SELECT 
    branch_name,
    SUM(balance) as total_deposits
FROM Account
GROUP BY branch_name
HAVING SUM(balance) = (
    SELECT MAX(branch_total)
    FROM (
        SELECT SUM(balance) as branch_total
        FROM Account
        GROUP BY branch_name
    ) as branch_sums
);

-- 3. Find customers in the same city as Pramod Singh
SELECT cust_name, cust_address
FROM Customer
WHERE cust_address = (
    SELECT cust_address 
    FROM Customer 
    WHERE cust_name = 'Pramod Singh'
) AND cust_name != 'Pramod Singh';

-- 4. Calculate loan statistics by branch
SELECT 
    l.branch_name,
    COUNT(*) as total_loans,
    SUM(l.amount) as total_loan_amount,
    AVG(l.amount) as avg_loan_amount,
    MAX(l.amount) as max_loan_amount,
    MIN(l.amount) as min_loan_amount
FROM Loan l
GROUP BY l.branch_name
ORDER BY total_loan_amount DESC;</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">3.4 Advanced DML Operations</h3>
                <div class="concept-box">
                    <div class="code-block">-- 1. Update operations with conditions
UPDATE Account 
SET balance = balance * 1.05 
WHERE acc_type = 'Savings' AND balance > 20000;

-- 2. Conditional updates using CASE
UPDATE Loan 
SET interest_rate = CASE 
    WHEN amount > 250000 THEN 8.5
    WHEN amount BETWEEN 150000 AND 250000 THEN 9.0
    ELSE 9.5
END;

-- 3. Delete with subquery conditions
DELETE FROM Loan 
WHERE amount BETWEEN 130000 AND 150000;

-- 4. Complex INSERT with SELECT
INSERT INTO Account (branch_name, balance, acc_type)
SELECT 'Akurdi', 10000, 'Savings'
FROM Customer c
WHERE c.cust_address = 'Pune' 
AND c.cust_id NOT IN (SELECT cust_id FROM Depositor);

-- 5. MERGE operation (MySQL equivalent using INSERT ... ON DUPLICATE KEY UPDATE)
INSERT INTO Customer (cust_id, cust_name, cust_address, cust_phone)
VALUES (1007, 'New Customer', 'Pune', '9876543216')
ON DUPLICATE KEY UPDATE 
    cust_address = VALUES(cust_address),
    cust_phone = VALUES(cust_phone);</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">3.5 Set Operations and Window Functions</h3>
                <div class="concept-box">
                    <div class="code-block">-- 1. UNION - All customers (depositors and borrowers)
SELECT c.cust_name, 'Depositor' as customer_type
FROM Customer c
JOIN Depositor d ON c.cust_id = d.cust_id
UNION
SELECT c.cust_name, 'Borrower' as customer_type
FROM Customer c
JOIN Borrower b ON c.cust_id = b.cust_id;

-- 2. Window functions for ranking and analysis
SELECT 
    c.cust_name,
    a.balance,
    a.branch_name,
    RANK() OVER (ORDER BY a.balance DESC) as balance_rank,
    DENSE_RANK() OVER (PARTITION BY a.branch_name ORDER BY a.balance DESC) as branch_rank,
    SUM(a.balance) OVER (PARTITION BY a.branch_name) as branch_total,
    LAG(a.balance) OVER (ORDER BY a.balance) as prev_balance,
    LEAD(a.balance) OVER (ORDER BY a.balance) as next_balance
FROM Customer c
JOIN Depositor d ON c.cust_id = d.cust_id
JOIN Account a ON d.acc_no = a.acc_no;

-- 3. Common Table Expressions (CTE)
WITH BranchStats AS (
    SELECT 
        branch_name,
        COUNT(*) as account_count,
        SUM(balance) as total_balance,
        AVG(balance) as avg_balance
    FROM Account
    GROUP BY branch_name
),
HighPerformingBranches AS (
    SELECT branch_name
    FROM BranchStats
    WHERE total_balance > 40000
)
SELECT 
    c.cust_name,
    a.balance,
    bs.avg_balance,
    (a.balance - bs.avg_balance) as balance_diff
FROM Customer c
JOIN Depositor d ON c.cust_id = d.cust_id
JOIN Account a ON d.acc_no = a.acc_no
JOIN BranchStats bs ON a.branch_name = bs.branch_name
JOIN HighPerformingBranches hpb ON a.branch_name = hpb.branch_name;</div>
                </div>
            </div>
        </section>

        <!-- Section 4: PL/SQL Procedures -->
        <section id="plsql">
            <div class="section-header">
                <h2 class="text-3xl font-bold"><i class="fas fa-code mr-3"></i>4. PL/SQL Procedures and Functions</h2>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">4.1 Student Grade Classification System</h3>
                <div class="concept-box">
                    <h4 class="text-lg font-semibold mb-3">Database Schema and Procedures</h4>
                    <div class="code-block">-- Create Student database and tables
CREATE DATABASE StudentManagement;
USE StudentManagement;

CREATE TABLE Student (
    roll_no INT PRIMARY KEY,
    student_name VARCHAR(100) NOT NULL,
    marks1 INT CHECK (marks1 BETWEEN 0 AND 100),
    marks2 INT CHECK (marks2 BETWEEN 0 AND 100),
    marks3 INT CHECK (marks3 BETWEEN 0 AND 100),
    marks4 INT CHECK (marks4 BETWEEN 0 AND 100),
    marks5 INT CHECK (marks5 BETWEEN 0 AND 100)
);

CREATE TABLE Result (
    roll_no INT PRIMARY KEY,
    total_marks INT,
    percentage DECIMAL(5,2),
    class VARCHAR(30),
    FOREIGN KEY (roll_no) REFERENCES Student(roll_no)
);

-- Insert sample data
INSERT INTO Student VALUES 
(101, 'Aarav Sharma', 85, 90, 88, 92, 87),
(102, 'Priya Patel', 78, 82, 80, 85, 79),
(103, 'Sunil Kumar', 95, 93, 97, 89, 91),
(104, 'Meera Joshi', 65, 70, 68, 72, 69),
(105, 'Raj Singh', 45, 50, 48, 52, 49);

DELIMITER //

-- Function to calculate total marks with validation
CREATE FUNCTION calculate_total_marks(
    p_roll_no INT,
    p_marks1 INT,
    p_marks2 INT,
    p_marks3 INT,
    p_marks4 INT,
    p_marks5 INT
) RETURNS INT
READS SQL DATA
DETERMINISTIC
BEGIN
    DECLARE total INT DEFAULT 0;
    DECLARE error_msg VARCHAR(255);
    
    -- Validate marks range
    IF (p_marks1 < 0 OR p_marks1 > 100 OR
        p_marks2 < 0 OR p_marks2 > 100 OR
        p_marks3 < 0 OR p_marks3 > 100 OR
        p_marks4 < 0 OR p_marks4 > 100 OR
        p_marks5 < 0 OR p_marks5 > 100) THEN
        
        SET error_msg = CONCAT('Invalid marks for roll number: ', p_roll_no);
        SIGNAL SQLSTATE '45000' SET MESSAGE_TEXT = error_msg;
    END IF;
    
    SET total = p_marks1 + p_marks2 + p_marks3 + p_marks4 + p_marks5;
    RETURN total;
END //

-- Function to determine class based on total marks
CREATE FUNCTION determine_class(p_total_marks INT) RETURNS VARCHAR(30)
DETERMINISTIC
BEGIN
    DECLARE class_result VARCHAR(30);
    
    CASE
        WHEN p_total_marks >= 450 THEN SET class_result = 'Distinction';
        WHEN p_total_marks >= 400 THEN SET class_result = 'First Class';
        WHEN p_total_marks >= 350 THEN SET class_result = 'Higher Second Class';
        WHEN p_total_marks >= 300 THEN SET class_result = 'Second Class';
        WHEN p_total_marks >= 250 THEN SET class_result = 'Pass';
        ELSE SET class_result = 'Fail';
    END CASE;
    
    RETURN class_result;
END //

-- Procedure to process all students
CREATE PROCEDURE process_student_results()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE v_roll_no INT;
    DECLARE v_name VARCHAR(100);
    DECLARE v_marks1, v_marks2, v_marks3, v_marks4, v_marks5 INT;
    DECLARE v_total_marks INT;
    DECLARE v_percentage DECIMAL(5,2);
    DECLARE v_class VARCHAR(30);
    DECLARE error_count INT DEFAULT 0;
    
    -- Cursor for students
    DECLARE student_cursor CURSOR FOR 
        SELECT roll_no, student_name, marks1, marks2, marks3, marks4, marks5 
        FROM Student;
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    DECLARE CONTINUE HANDLER FOR SQLEXCEPTION 
    BEGIN
        SET error_count = error_count + 1;
        GET DIAGNOSTICS CONDITION 1
            @sqlstate = RETURNED_SQLSTATE,
            @errno = MYSQL_ERRNO,
            @text = MESSAGE_TEXT;
        SELECT CONCAT('Error processing roll_no: ', v_roll_no, ' - ', @text) as error_message;
    END;
    
    -- Clear existing results
    DELETE FROM Result;
    
    OPEN student_cursor;
    
    read_loop: LOOP
        FETCH student_cursor INTO v_roll_no, v_name, v_marks1, v_marks2, v_marks3, v_marks4, v_marks5;
        
        IF done THEN
            LEAVE read_loop;
        END IF;
        
        -- Calculate total marks using function
        SET v_total_marks = calculate_total_marks(v_roll_no, v_marks1, v_marks2, v_marks3, v_marks4, v_marks5);
        SET v_percentage = (v_total_marks * 100.0) / 500.0;
        SET v_class = determine_class(v_total_marks);
        
        -- Insert into Result table
        INSERT INTO Result (roll_no, total_marks, percentage, class)
        VALUES (v_roll_no, v_total_marks, v_percentage, v_class);
        
    END LOOP;
    
    CLOSE student_cursor;
    
    -- Display summary
    SELECT 
        CONCAT('Processing completed. Total errors: ', error_count) as summary,
        COUNT(*) as total_processed
    FROM Result;
    
END //

DELIMITER ;</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">4.2 Library Fine Management System</h3>
                <div class="concept-box">
                    <div class="code-block">-- Library Management System
CREATE DATABASE LibraryManagement;
USE LibraryManagement;

CREATE TABLE Borrower (
    roll_no INT PRIMARY KEY,
    student_name VARCHAR(100) NOT NULL,
    date_of_issue DATE NOT NULL,
    book_name VARCHAR(200) NOT NULL,
    status ENUM('I', 'R') DEFAULT 'I' -- I=Issued, R=Returned
);

CREATE TABLE Fine (
    fine_id INT AUTO_INCREMENT PRIMARY KEY,
    roll_no INT,
    fine_date DATE DEFAULT CURRENT_DATE,
    fine_amount DECIMAL(8,2) DEFAULT 0,
    book_name VARCHAR(200),
    days_overdue INT,
    FOREIGN KEY (roll_no) REFERENCES Borrower(roll_no)
);

-- Sample data
INSERT INTO Borrower VALUES 
(101, 'Aarav Sharma', '2024-01-15', 'Database Systems', 'I'),
(102, 'Priya Patel', '2024-02-01', 'Operating Systems', 'I'),
(103, 'Sunil Kumar', '2023-12-20', 'Data Structures', 'I'),
(104, 'Meera Joshi', '2024-02-10', 'Computer Networks', 'R');

DELIMITER //

-- Procedure for book return and fine calculation
CREATE PROCEDURE return_book(
    IN p_roll_no INT,
    IN p_book_name VARCHAR(200)
)
BEGIN
    DECLARE v_issue_date DATE;
    DECLARE v_days_diff INT;
    DECLARE v_fine_amount DECIMAL(8,2) DEFAULT 0;
    DECLARE v_book_found INT DEFAULT 0;
    DECLARE v_already_returned INT DEFAULT 0;
    
    -- Exception handling
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        RESIGNAL;
    END;
    
    START TRANSACTION;
    
    -- Check if book exists and is issued
    SELECT COUNT(*), date_of_issue 
    INTO v_book_found, v_issue_date
    FROM Borrower 
    WHERE roll_no = p_roll_no 
      AND book_name = p_book_name 
      AND status = 'I';
    
    IF v_book_found = 0 THEN
        SELECT 'Error: Book not found or already returned' as message;
        ROLLBACK;
    ELSE
        -- Calculate days since issue
        SET v_days_diff = DATEDIFF(CURRENT_DATE, v_issue_date);
        
        -- Calculate fine based on rules
        CASE
            WHEN v_days_diff <= 14 THEN 
                SET v_fine_amount = 0;
            WHEN v_days_diff BETWEEN 15 AND 30 THEN 
                SET v_fine_amount = (v_days_diff - 14) * 5;
            WHEN v_days_diff > 30 THEN 
                SET v_fine_amount = 16 * 5 + (v_days_diff - 30) * 50;
        END CASE;
        
        -- Update book status to returned
        UPDATE Borrower 
        SET status = 'R' 
        WHERE roll_no = p_roll_no AND book_name = p_book_name;
        
        -- Insert fine record if applicable
        IF v_fine_amount > 0 THEN
            INSERT INTO Fine (roll_no, fine_amount, book_name, days_overdue)
            VALUES (p_roll_no, v_fine_amount, p_book_name, v_days_diff - 14);
        END IF;
        
        -- Display result
        SELECT 
            p_roll_no as roll_number,
            p_book_name as book_name,
            v_issue_date as issue_date,
            CURRENT_DATE as return_date,
            v_days_diff as total_days,
            v_fine_amount as fine_amount,
            CASE 
                WHEN v_fine_amount = 0 THEN 'No Fine'
                ELSE CONCAT('Fine Applied: ₹', v_fine_amount)
            END as status;
        
        COMMIT;
    END IF;
    
END //

-- Procedure to calculate fine for all overdue books
CREATE PROCEDURE calculate_all_fines()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE v_roll_no INT;
    DECLARE v_book_name VARCHAR(200);
    DECLARE v_issue_date DATE;
    DECLARE v_days_diff INT;
    DECLARE v_fine_amount DECIMAL(8,2);
    DECLARE total_fines DECIMAL(10,2) DEFAULT 0;
    DECLARE overdue_count INT DEFAULT 0;
    
    DECLARE overdue_cursor CURSOR FOR 
        SELECT roll_no, book_name, date_of_issue,
               DATEDIFF(CURRENT_DATE, date_of_issue) as days_diff
        FROM Borrower 
        WHERE status = 'I' 
          AND DATEDIFF(CURRENT_DATE, date_of_issue) > 14;
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    
    OPEN overdue_cursor;
    
    fine_loop: LOOP
        FETCH overdue_cursor INTO v_roll_no, v_book_name, v_issue_date, v_days_diff;
        
        IF done THEN
            LEAVE fine_loop;
        END IF;
        
        -- Calculate fine
        CASE
            WHEN v_days_diff BETWEEN 15 AND 30 THEN 
                SET v_fine_amount = (v_days_diff - 14) * 5;
            WHEN v_days_diff > 30 THEN 
                SET v_fine_amount = 16 * 5 + (v_days_diff - 30) * 50;
        END CASE;
        
        -- Insert or update fine record
        INSERT INTO Fine (roll_no, fine_amount, book_name, days_overdue)
        VALUES (v_roll_no, v_fine_amount, v_book_name, v_days_diff - 14)
        ON DUPLICATE KEY UPDATE 
            fine_amount = v_fine_amount,
            days_overdue = v_days_diff - 14;
        
        SET total_fines = total_fines + v_fine_amount;
        SET overdue_count = overdue_count + 1;
        
    END LOOP;
    
    CLOSE overdue_cursor;
    
    SELECT 
        overdue_count as total_overdue_books,
        total_fines as total_fine_amount,
        CONCAT('₹', FORMAT(total_fines, 2)) as formatted_total;
    
END //

DELIMITER ;</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">4.3 Employee Tax Calculation System</h3>
                <div class="concept-box">
                    <div class="code-block">-- Employee Tax Management
CREATE DATABASE EmployeeTax;
USE EmployeeTax;

CREATE TABLE Employee (
    emp_no INT PRIMARY KEY,
    emp_name VARCHAR(100) NOT NULL,
    basic_salary DECIMAL(10,2) NOT NULL,
    hra DECIMAL(10,2) DEFAULT 0,
    da DECIMAL(10,2) DEFAULT 0,
    total_deduction DECIMAL(10,2) DEFAULT 0,
    gross_salary DECIMAL(10,2) GENERATED ALWAYS AS (basic_salary + hra + da) STORED,
    net_salary DECIMAL(10,2) GENERATED ALWAYS AS (basic_salary + hra + da - total_deduction) STORED
);

CREATE TABLE TaxCalculation (
    emp_no INT PRIMARY KEY,
    gross_salary DECIMAL(10,2),
    tax_rate DECIMAL(5,2),
    tax_amount DECIMAL(10,2),
    net_after_tax DECIMAL(10,2),
    calculation_date DATE DEFAULT CURRENT_DATE,
    FOREIGN KEY (emp_no) REFERENCES Employee(emp_no)
);

-- Sample data
INSERT INTO Employee (emp_no, emp_name, basic_salary, hra, da, total_deduction) VALUES 
(101, 'Aarav Sharma', 50000, 10000, 5000, 7000),
(102, 'Priya Patel', 60000, 12000, 6000, 8000),
(103, 'Sunil Kumar', 45000, 9000, 4500, 6500),
(104, 'Meera Joshi', 70000, 14000, 7000, 10000);

DELIMITER //

-- Function to calculate tax based on salary slabs
CREATE FUNCTION calculate_tax_rate(p_gross_salary DECIMAL(10,2)) 
RETURNS DECIMAL(5,2)
DETERMINISTIC
BEGIN
    DECLARE tax_rate DECIMAL(5,2);
    
    CASE
        WHEN p_gross_salary <= 300000 THEN SET tax_rate = 0.00;    -- No tax
        WHEN p_gross_salary <= 500000 THEN SET tax_rate = 5.00;    -- 5% tax
        WHEN p_gross_salary <= 1000000 THEN SET tax_rate = 10.00;  -- 10% tax
        ELSE SET tax_rate = 15.00;                                  -- 15% tax
    END CASE;
    
    RETURN tax_rate;
END //

-- Procedure to calculate tax for all employees using cursor
CREATE PROCEDURE calculate_employee_tax()
BEGIN
    DECLARE done INT DEFAULT FALSE;
    DECLARE v_emp_no INT;
    DECLARE v_emp_name VARCHAR(100);
    DECLARE v_gross_salary DECIMAL(10,2);
    DECLARE v_tax_rate DECIMAL(5,2);
    DECLARE v_tax_amount DECIMAL(10,2);
    DECLARE v_net_after_tax DECIMAL(10,2);
    DECLARE total_tax DECIMAL(12,2) DEFAULT 0;
    DECLARE emp_count INT DEFAULT 0;
    
    -- Cursor for employee data
    DECLARE emp_cursor CURSOR FOR 
        SELECT emp_no, emp_name, gross_salary 
        FROM Employee;
    
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    
    -- Clear existing tax calculations
    DELETE FROM TaxCalculation;
    
    -- Display header
    SELECT 'EMPLOYEE TAX CALCULATION REPORT' as title,
           DATE_FORMAT(NOW(), '%Y-%m-%d %H:%i:%s') as generated_on;
    
    SELECT CONCAT(
        RPAD('Emp No', 8, ' '), ' | ',
        RPAD('Employee Name', 20, ' '), ' | ',
        RPAD('Gross Salary', 12, ' '), ' | ',
        RPAD('Tax Rate%', 10, ' '), ' | ',
        RPAD('Tax Amount', 12, ' '), ' | ',
        RPAD('Net After Tax', 15, ' ')
    ) as header;
    
    SELECT REPEAT('-', 85) as separator;
    
    OPEN emp_cursor;
    
    tax_loop: LOOP
        FETCH emp_cursor INTO v_emp_no, v_emp_name, v_gross_salary;
        
        IF done THEN
            LEAVE tax_loop;
        END IF;
        
        -- Calculate tax
        SET v_tax_rate = calculate_tax_rate(v_gross_salary);
        SET v_tax_amount = (v_gross_salary * v_tax_rate) / 100;
        SET v_net_after_tax = v_gross_salary - v_tax_amount;
        
        -- Insert into tax calculation table
        INSERT INTO TaxCalculation (emp_no, gross_salary, tax_rate, tax_amount, net_after_tax)
        VALUES (v_emp_no, v_gross_salary, v_tax_rate, v_tax_amount, v_net_after_tax);
        
        -- Display employee tax details
        SELECT CONCAT(
            RPAD(v_emp_no, 8, ' '), ' | ',
            RPAD(v_emp_name, 20, ' '), ' | ',
            RPAD(FORMAT(v_gross_salary, 2), 12, ' '), ' | ',
            RPAD(CONCAT(v_tax_rate, '%'), 10, ' '), ' | ',
            RPAD(FORMAT(v_tax_amount, 2), 12, ' '), ' | ',
            RPAD(FORMAT(v_net_after_tax, 2), 15, ' ')
        ) as employee_details;
        
        SET total_tax = total_tax + v_tax_amount;
        SET emp_count = emp_count + 1;
        
    END LOOP;
    
    CLOSE emp_cursor;
    
    -- Display summary
    SELECT REPEAT('-', 85) as separator;
    SELECT CONCAT('Total Employees Processed: ', emp_count) as summary1;
    SELECT CONCAT('Total Tax Collected: ₹', FORMAT(total_tax, 2)) as summary2;
    
END //

-- Procedure for individual employee tax calculation
CREATE PROCEDURE get_employee_tax_details(IN p_emp_no INT)
BEGIN
    DECLARE v_emp_name VARCHAR(100);
    DECLARE v_gross_salary DECIMAL(10,2);
    DECLARE v_tax_rate DECIMAL(5,2);
    DECLARE v_tax_amount DECIMAL(10,2);
    DECLARE v_net_after_tax DECIMAL(10,2);
    DECLARE emp_exists INT DEFAULT 0;
    
    -- Check if employee exists
    SELECT COUNT(*), emp_name, gross_salary
    INTO emp_exists, v_emp_name, v_gross_salary
    FROM Employee
    WHERE emp_no = p_emp_no;
    
    IF emp_exists = 0 THEN
        SELECT CONCAT('Employee with ID ', p_emp_no, ' not found') as error_message;
    ELSE
        SET v_tax_rate = calculate_tax_rate(v_gross_salary);
        SET v_tax_amount = (v_gross_salary * v_tax_rate) / 100;
        SET v_net_after_tax = v_gross_salary - v_tax_amount;
        
        SELECT 
            p_emp_no as employee_id,
            v_emp_name as employee_name,
            FORMAT(v_gross_salary, 2) as gross_salary,
            CONCAT(v_tax_rate, '%') as tax_rate,
            FORMAT(v_tax_amount, 2) as tax_amount,
            FORMAT(v_net_after_tax, 2) as net_after_tax,
            CASE 
                WHEN v_tax_rate = 0 THEN 'Tax Exempt'
                WHEN v_tax_rate <= 5 THEN 'Low Tax Bracket'
                WHEN v_tax_rate <= 10 THEN 'Medium Tax Bracket'
                ELSE 'High Tax Bracket'
            END as tax_bracket;
    END IF;
    
END //

DELIMITER ;</div>
                </div>
            </div>
        </section>

        <!-- Section 5: Database Triggers -->
        <section id="triggers">
            <div class="section-header">
                <h2 class="text-3xl font-bold"><i class="fas fa-bolt mr-3"></i>5. Database Triggers</h2>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">5.1 Audit Trail System</h3>
                <div class="concept-box">
                    <div class="code-block">-- Audit Trail Implementation
CREATE DATABASE AuditSystem;
USE AuditSystem;

-- Main Library table
CREATE TABLE Library (
    book_id INT PRIMARY KEY AUTO_INCREMENT,
    book_name VARCHAR(200) NOT NULL,
    author VARCHAR(100),
    publisher VARCHAR(100),
    copies_available INT DEFAULT 1,
    total_copies INT DEFAULT 1,
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
);

-- Audit table to track all changes
CREATE TABLE Library_Audit (
    audit_id INT AUTO_INCREMENT PRIMARY KEY,
    book_id INT,
    book_name VARCHAR(200),
    author VARCHAR(100),
    publisher VARCHAR(100),
    copies_available INT,
    total_copies INT,
    operation_type ENUM('INSERT', 'UPDATE', 'DELETE'),
    old_values JSON,
    new_values JSON,
    changed_by VARCHAR(100) DEFAULT USER(),
    change_timestamp TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    session_id VARCHAR(100) DEFAULT CONNECTION_ID()
);

-- Insert sample data
INSERT INTO Library (book_name, author, publisher, copies_available, total_copies) VALUES 
('Database Systems', 'Ramez Elmasri', 'Pearson Education', 5, 5),
('Operating Systems', 'Abraham Silberschatz', 'John Wiley & Sons', 3, 3),
('Data Structures', 'Robert L. Kruse', 'Prentice Hall', 4, 4),
('Computer Networks', 'Andrew S. Tanenbaum', 'Pearson Education', 2, 2);

DELIMITER //

-- AFTER INSERT Trigger
CREATE TRIGGER library_after_insert
AFTER INSERT ON Library
FOR EACH ROW
BEGIN
    INSERT INTO Library_Audit (
        book_id, book_name, author, publisher, copies_available, total_copies,
        operation_type, new_values
    ) VALUES (
        NEW.book_id, NEW.book_name, NEW.author, NEW.publisher, 
        NEW.copies_available, NEW.total_copies,
        'INSERT',
        JSON_OBJECT(
            'book_id', NEW.book_id,
            'book_name', NEW.book_name,
            'author', NEW.author,
            'publisher', NEW.publisher,
            'copies_available', NEW.copies_available,
            'total_copies', NEW.total_copies
        )
    );
END //

-- AFTER UPDATE Trigger
CREATE TRIGGER library_after_update
AFTER UPDATE ON Library
FOR EACH ROW
BEGIN
    INSERT INTO Library_Audit (
        book_id, book_name, author, publisher, copies_available, total_copies,
        operation_type, old_values, new_values
    ) VALUES (
        NEW.book_id, NEW.book_name, NEW.author, NEW.publisher,
        NEW.copies_available, NEW.total_copies,
        'UPDATE',
        JSON_OBJECT(
            'book_id', OLD.book_id,
            'book_name', OLD.book_name,
            'author', OLD.author,
            'publisher', OLD.publisher,
            'copies_available', OLD.copies_available,
            'total_copies', OLD.total_copies
        ),
        JSON_OBJECT(
            'book_id', NEW.book_id,
            'book_name', NEW.book_name,
            'author', NEW.author,
            'publisher', NEW.publisher,
            'copies_available', NEW.copies_available,
            'total_copies', NEW.total_copies
        )
    );
END //

-- AFTER DELETE Trigger
CREATE TRIGGER library_after_delete
AFTER DELETE ON Library
FOR EACH ROW
BEGIN
    INSERT INTO Library_Audit (
        book_id, book_name, author, publisher, copies_available, total_copies,
        operation_type, old_values
    ) VALUES (
        OLD.book_id, OLD.book_name, OLD.author, OLD.publisher,
        OLD.copies_available, OLD.total_copies,
        'DELETE',
        JSON_OBJECT(
            'book_id', OLD.book_id,
            'book_name', OLD.book_name,
            'author', OLD.author,
            'publisher', OLD.publisher,
            'copies_available', OLD.copies_available,
            'total_copies', OLD.total_copies
        )
    );
END //

-- BEFORE UPDATE trigger for validation
CREATE TRIGGER library_before_update
BEFORE UPDATE ON Library
FOR EACH ROW
BEGIN
    -- Validate that available copies don't exceed total copies
    IF NEW.copies_available > NEW.total_copies THEN
        SIGNAL SQLSTATE '45000' 
        SET MESSAGE_TEXT = 'Available copies cannot exceed total copies';
    END IF;
    
    -- Validate that copies are not negative
    IF NEW.copies_available < 0 OR NEW.total_copies < 0 THEN
        SIGNAL SQLSTATE '45000' 
        SET MESSAGE_TEXT = 'Copies cannot be negative';
    END IF;
END //

DELIMITER ;

-- Procedure to view audit history for a specific book
DELIMITER //

CREATE PROCEDURE get_book_audit_history(IN p_book_id INT)
BEGIN
    SELECT 
        audit_id,
        book_name,
        operation_type,
        CASE 
            WHEN operation_type = 'INSERT' THEN 'Book Added'
            WHEN operation_type = 'UPDATE' THEN 'Book Updated'
            WHEN operation_type = 'DELETE' THEN 'Book Deleted'
        END as operation_description,
        old_values,
        new_values,
        changed_by as user_name,
        change_timestamp,
        session_id
    FROM Library_Audit
    WHERE book_id = p_book_id
    ORDER BY change_timestamp DESC;
END //

-- Procedure to get audit summary
CREATE PROCEDURE get_audit_summary(IN p_days INT)
BEGIN
    SELECT 
        operation_type,
        COUNT(*) as operation_count,
        COUNT(DISTINCT book_id) as unique_books_affected,
        MIN(change_timestamp) as first_operation,
        MAX(change_timestamp) as last_operation
    FROM Library_Audit
    WHERE change_timestamp >= DATE_SUB(NOW(), INTERVAL p_days DAY)
    GROUP BY operation_type
    ORDER BY operation_count DESC;
END //

DELIMITER ;</div>
                </div>
            </div>
        </section>

        <!-- Section 6: MongoDB Operations -->
        <section id="mongodb">
            <div class="section-header">
                <h2 class="text-3xl font-bold"><i class="fas fa-leaf mr-3"></i>6. MongoDB Operations</h2>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">6.1 Document Structure and CRUD Operations</h3>
                <div class="concept-box">
                    <h4 class="text-lg font-semibold mb-3">Student Management System</h4>
                    <div class="code-block">// MongoDB Student Management System

// Use database
use StudentDB;

// Create collection with document validation
db.createCollection("Students", {
   validator: {
      $jsonSchema: {
         bsonType: "object",
         required: ["stud_id", "stud_name", "stud_addr"],
         properties: {
            stud_id: {
               bsonType: "int",
               minimum: 1,
               description: "Student ID must be a positive integer"
            },
            stud_name: {
               bsonType: "string",
               minLength: 2,
               maxLength: 100,
               description: "Student name must be 2-100 characters"
            },
            stud_addr: {
               bsonType: "string",
               description: "Student address is required"
            },
            stud_marks: {
               bsonType: "array",
               items: {
                  bsonType: "int",
                  minimum: 0,
                  maximum: 100
               },
               description: "Marks must be integers between 0-100"
            },
            total_marks: {
               bsonType: "int",
               minimum: 0,
               description: "Total marks must be non-negative"
            },
            percentage: {
               bsonType: "double",
               minimum: 0,
               maximum: 100,
               description: "Percentage must be between 0-100"
            }
         }
      }
   }
});

// Insert comprehensive student data
db.Students.insertMany([
    {
        stud_id: 101,
        stud_name: "Aarav Sharma",
        stud_addr: "Pune",
        stud_marks: [85, 90, 88, 92, 87],
        total_marks: 442,
        percentage: 88.4,
        email: "aarav@email.com",
        phone: "9876543210",
        enrollment_date: new Date("2024-01-15"),
        course: "Computer Science"
    },
    {
        stud_id: 102,
        stud_name: "Priya Patel",
        stud_addr: "Mumbai",
        stud_marks: [78, 82, 80, 85, 79],
        total_marks: 404,
        percentage: 80.8,
        email: "priya@email.com",
        phone: "9876543211",
        enrollment_date: new Date("2024-01-16"),
        course: "Information Technology"
    },
    {
        stud_id: 103,
        stud_name: "Sunil Kumar",
        stud_addr: "Delhi",
        stud_marks: [95, 93, 97, 89, 91],
        total_marks: 465,
        percentage: 93.0,
        email: "sunil@email.com",
        phone: "9876543212",
        enrollment_date: new Date("2024-01-17"),
        course: "Computer Science"
    },
    {
        stud_id: 104,
        stud_name: "Meera Joshi",
        stud_addr: "Pune",
        stud_marks: [65, 70, 68, 72, 69],
        total_marks: 344,
        percentage: 68.8,
        email: "meera@email.com",
        phone: "9876543213",
        enrollment_date: new Date("2024-01-18"),
        course: "Electronics"
    }
]);

// CRUD Operations Examples

// 1. CREATE - Insert new student
db.Students.insertOne({
    stud_id: 105,
    stud_name: "Raj Singh",
    stud_addr: "Bangalore",
    stud_marks: [75, 80, 77, 82, 79],
    total_marks: 393,
    percentage: 78.6,
    email: "raj@email.com",
    phone: "9876543214",
    enrollment_date: new Date(),
    course: "Mechanical Engineering"
});

// 2. READ Operations
// Find all students
db.Students.find().pretty();

// Find students from specific city
db.Students.find({stud_addr: "Pune"}).pretty();

// Find students with percentage > 80
db.Students.find({percentage: {$gt: 80}});

// Find students with specific marks range
db.Students.find({
    total_marks: {$gte: 400, $lte: 450}
});

// Complex query with multiple conditions
db.Students.find({
    $and: [
        {stud_addr: "Pune"},
        {percentage: {$gte: 75}}
    ]
});

// 3. UPDATE Operations
// Update single student's marks
db.Students.updateOne(
    {stud_id: 104},
    {
        $set: {
            stud_marks: [70, 75, 72, 77, 74],
            total_marks: 368,
            percentage: 73.6
        }
    }
);

// Update multiple students - add graduation year
db.Students.updateMany(
    {course: "Computer Science"},
    {
        $set: {graduation_year: 2028}
    }
);

// Increment marks for all students from Pune
db.Students.updateMany(
    {stud_addr: "Pune"},
    {
        $inc: {total_marks: 10, percentage: 2}
    }
);

// 4. DELETE Operations
// Delete student with specific ID
db.Students.deleteOne({stud_id: 105});

// Delete students with percentage < 70
db.Students.deleteMany({percentage: {$lt: 70}});</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">6.2 Indexing and Query Optimization</h3>
                <div class="concept-box">
                    <div class="code-block">// MongoDB Indexing Strategies

// 1. Single Field Indexes
db.Students.createIndex({stud_id: 1});  // Ascending
db.Students.createIndex({stud_name: 1});
db.Students.createIndex({percentage: -1}); // Descending

// 2. Compound Indexes
db.Students.createIndex({stud_addr: 1, percentage: -1});
db.Students.createIndex({course: 1, total_marks: -1, stud_name: 1});

// 3. Text Indexes for searching
db.Students.createIndex({stud_name: "text", course: "text"});

// 4. Partial Indexes (conditional)
db.Students.createIndex(
    {percentage: 1},
    {partialFilterExpression: {percentage: {$gte: 75}}}
);

// 5. Sparse Indexes (only for documents with the field)
db.Students.createIndex({graduation_year: 1}, {sparse: true});

// Query Performance Analysis
// Explain query execution
db.Students.find({stud_addr: "Pune"}).explain("executionStats");

// Find students with text search
db.Students.find({$text: {$search: "Computer Science"}});

// Optimized queries using indexes
db.Students.find({stud_addr: "Pune", percentage: {$gte: 80}})
          .sort({percentage: -1})
          .limit(5);

// List all indexes
db.Students.getIndexes();

// Drop specific index
db.Students.dropIndex({stud_name: 1});

// Query optimization examples
// Use hint to force specific index
db.Students.find({stud_addr: "Pune"})
          .hint({stud_addr: 1, percentage: -1});

// Projection to return only required fields
db.Students.find(
    {percentage: {$gte: 80}},
    {stud_name: 1, percentage: 1, course: 1, _id: 0}
);</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">6.3 Aggregation Framework</h3>
                <div class="concept-box">
                    <div class="code-block">// MongoDB Aggregation Examples

// 1. Basic Aggregation Pipeline
db.Students.aggregate([
    {
        $group: {
            _id: "$stud_addr",
            total_students: {$sum: 1},
            avg_percentage: {$avg: "$percentage"},
            max_marks: {$max: "$total_marks"},
            min_marks: {$min: "$total_marks"}
        }
    },
    {
        $sort: {avg_percentage: -1}
    }
]);

// 2. Complex Aggregation with Multiple Stages
db.Students.aggregate([
    // Stage 1: Match students with percentage >= 70
    {
        $match: {percentage: {$gte: 70}}
    },
    // Stage 2: Add calculated fields
    {
        $addFields: {
            grade: {
                $switch: {
                    branches: [
                        {case: {$gte: ["$percentage", 90]}, then: "A+"},
                        {case: {$gte: ["$percentage", 80]}, then: "A"},
                        {case: {$gte: ["$percentage", 70]}, then: "B"}
                    ],
                    default: "C"
                }
            },
            marks_category: {
                $cond: {
                    if: {$gte: ["$total_marks", 400]},
                    then: "High Achiever",
                    else: "Average"
                }
            }
        }
    },
    // Stage 3: Group by course and grade
    {
        $group: {
            _id: {
                course: "$course",
                grade: "$grade"
            },
            count: {$sum: 1},
            students: {$push: "$stud_name"},
            avg_percentage: {$avg: "$percentage"}
        }
    },
    // Stage 4: Sort results
    {
        $sort: {"_id.course": 1, "_id.grade": 1}
    }
]);

// 3. Advanced Aggregation - Student Performance Analysis
db.Students.aggregate([
    {
        $addFields: {
            subject_wise_analysis: {
                $map: {
                    input: {$range: [0, {$size: "$stud_marks"}]},
                    as: "index",
                    in: {
                        subject_no: {$add: ["$$index", 1]},
                        marks: {$arrayElemAt: ["$stud_marks", "$$index"]},
                        performance: {
                            $cond: {
                                if: {$gte: [{$arrayElemAt: ["$stud_marks", "$$index"]}, 80]},
                                then: "Excellent",
                                else: {
                                    $cond: {
                                        if: {$gte: [{$arrayElemAt: ["$stud_marks", "$$index"]}, 70]},
                                        then: "Good",
                                        else: "Need Improvement"
                                    }
                                }
                            }
                        }
                    }
                }
            }
        }
    },
    {
        $project: {
            stud_name: 1,
            stud_addr: 1,
            total_marks: 1,
            percentage: 1,
            subject_wise_analysis: 1,
            overall_grade: {
                $switch: {
                    branches: [
                        {case: {$gte: ["$percentage", 90]}, then: "Distinction"},
                        {case: {$gte: ["$percentage", 75]}, then: "First Class"},
                        {case: {$gte: ["$percentage", 60]}, then: "Second Class"}
                    ],
                    default: "Pass"
                }
            }
        }
    }
]);

// 4. Lookup (Join) Operations
// Create a separate courses collection
db.Courses.insertMany([
    {course_id: "CS", course_name: "Computer Science", department: "Engineering", credits: 180},
    {course_id: "IT", course_name: "Information Technology", department: "Engineering", credits: 180},
    {course_id: "EC", course_name: "Electronics", department: "Engineering", credits: 180},
    {course_id: "ME", course_name: "Mechanical Engineering", department: "Engineering", credits: 180}
]);

// Join students with course details
db.Students.aggregate([
    {
        $lookup: {
            from: "Courses",
            localField: "course",
            foreignField: "course_name",
            as: "course_details"
        }
    },
    {
        $unwind: "$course_details"
    },
    {
        $project: {
            stud_name: 1,
            percentage: 1,
            course: 1,
            department: "$course_details.department",
            credits: "$course_details.credits"
        }
    }
]);

// 5. MapReduce Example (Alternative to Aggregation)
db.Students.mapReduce(
    // Map function
    function() {
        emit(this.stud_addr, {
            total_marks: this.total_marks,
            count: 1
        });
    },
    // Reduce function
    function(key, values) {
        var result = {total_marks: 0, count: 0};
        values.forEach(function(value) {
            result.total_marks += value.total_marks;
            result.count += value.count;
        });
        return result;
    },
    // Options
    {
        out: "student_city_stats",
        finalize: function(key, reducedValue) {
            reducedValue.avg_marks = reducedValue.total_marks / reducedValue.count;
            return reducedValue;
        }
    }
);

// View MapReduce results
db.student_city_stats.find().pretty();</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">6.4 Advanced MongoDB Operations</h3>
                <div class="concept-box">
                    <div class="code-block">// Advanced MongoDB Operations

// 1. Geospatial Queries
// Create collection with location data
db.CityDetails.insertMany([
    {
        _id: 1,
        name: "Pune",
        area: 243.84,
        population: {
            total: 3124000,
            adults: 2000000,
            senior_citizens: 300000,
            sex_ratio: 945
        },
        geography: {
            avg_temp: 25,
            avg_rainfall: 722,
            coordinates: [73.8567, 18.5204]  // [longitude, latitude]
        }
    },
    {
        _id: 2,
        name: "Mumbai",
        area: 603.4,
        population: {
            total: 12478447,
            adults: 8000000,
            senior_citizens: 1000000,
            sex_ratio: 832
        },
        geography: {
            avg_temp: 27,
            avg_rainfall: 2167,
            coordinates: [72.8777, 19.0760]
        }
    },
    {
        _id: 3,
        name: "Delhi",
        area: 1484,
        population: {
            total: 16787941,
            adults: 11000000,
            senior_citizens: 1200000,
            sex_ratio: 868
        },
        geography: {
            avg_temp: 24,
            avg_rainfall: 797,
            coordinates: [77.1025, 28.7041]
        }
    }
]);

// Create 2dsphere index for geospatial queries
db.CityDetails.createIndex({"geography.coordinates": "2dsphere"});

// Find cities near a specific location (within 500km of Pune)
db.CityDetails.find({
    "geography.coordinates": {
        $near: {
            $geometry: {
                type: "Point",
                coordinates: [73.8567, 18.5204]
            },
            $maxDistance: 500000  // 500 km in meters
        }
    }
});

// 2. Text Search and Full-Text Indexing
// Create text index
db.CityDetails.createIndex({
    "name": "text",
    "geography.avg_temp": "text"
});

// Text search
db.CityDetails.find({$text: {$search: "Mumbai Delhi"}});

// 3. Complex Population Analysis
db.CityDetails.aggregate([
    {
        $addFields: {
            population_density: {
                $divide: ["$population.total", "$area"]
            },
            adult_percentage: {
                $multiply: [
                    {$divide: ["$population.adults", "$population.total"]},
                    100
                ]
            }
        }
    },
    {
        $match: {
            "geography.avg_rainfall": {$gt: 700}
        }
    },
    {
        $project: {
            name: 1,
            area: 1,
            "population.total": 1,
            population_density: {$round: ["$population_density", 2]},
            adult_percentage: {$round: ["$adult_percentage", 2]},
            "geography.avg_rainfall": 1,
            density_category: {
                $switch: {
                    branches: [
                        {case: {$gt: ["$population_density", 10000]}, then: "Very High"},
                        {case: {$gt: ["$population_density", 5000]}, then: "High"},
                        {case: {$gt: ["$population_density", 1000]}, then: "Medium"}
                    ],
                    default: "Low"
                }
            }
        }
    },
    {
        $sort: {population_density: -1}
    }
]);

// 4. Time Series Operations
// Create collection for weather data
db.WeatherData.insertMany([
    {
        city: "Pune",
        date: new Date("2024-01-01"),
        temperature: 22,
        humidity: 65,
        rainfall: 0
    },
    {
        city: "Pune",
        date: new Date("2024-01-02"),
        temperature: 25,
        humidity: 70,
        rainfall: 5
    },
    {
        city: "Mumbai",
        date: new Date("2024-01-01"),
        temperature: 28,
        humidity: 75,
        rainfall: 2
    }
]);

// Time series aggregation
db.WeatherData.aggregate([
    {
        $group: {
            _id: {
                city: "$city",
                month: {$month: "$date"},
                year: {$year: "$date"}
            },
            avg_temperature: {$avg: "$temperature"},
            total_rainfall: {$sum: "$rainfall"},
            avg_humidity: {$avg: "$humidity"},
            readings_count: {$sum: 1}
        }
    },
    {
        $project: {
            city: "$_id.city",
            month: "$_id.month",
            year: "$_id.year",
            avg_temperature: {$round: ["$avg_temperature", 1]},
            total_rainfall: 1,
            avg_humidity: {$round: ["$avg_humidity", 1]},
            readings_count: 1,
            _id: 0
        }
    },
    {
        $sort: {city: 1, year: 1, month: 1}
    }
]);

// 5. Data Validation and Schema Evolution
// Update collection validation rules
db.runCommand({
    collMod: "Students",
    validator: {
        $jsonSchema: {
            bsonType: "object",
            required: ["stud_id", "stud_name", "stud_addr", "email"],
            properties: {
                stud_id: {
                    bsonType: "int",
                    minimum: 1
                },
                email: {
                    bsonType: "string",
                    pattern: "^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\\.[a-zA-Z]{2,}$"
                },
                stud_marks: {
                    bsonType: "array",
                    minItems: 3,
                    maxItems: 10,
                    items: {
                        bsonType: "int",
                        minimum: 0,
                        maximum: 100
                    }
                }
            }
        }
    },
    validationLevel: "moderate",
    validationAction: "warn"
});</div>
                </div>
            </div>
        </section>

        <!-- Section 7: Best Practices -->
        <section id="best-practices">
            <div class="section-header">
                <h2 class="text-3xl font-bold"><i class="fas fa-star mr-3"></i>7. Database Best Practices</h2>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">7.1 SQL Database Design Principles</h3>
                <div class="concept-box">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-blue-600">Normalization Guidelines</h4>
                            <ul class="space-y-2">
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mr-2 mt-1"></i>
                                    <span><strong>1NF:</strong> Eliminate repeating groups and ensure atomic values</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mr-2 mt-1"></i>
                                    <span><strong>2NF:</strong> Remove partial dependencies on composite keys</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mr-2 mt-1"></i>
                                    <span><strong>3NF:</strong> Eliminate transitive dependencies</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-check-circle text-green-500 mr-2 mt-1"></i>
                                    <span><strong>BCNF:</strong> Every determinant must be a candidate key</span>
                                </li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-green-600">Indexing Strategies</h4>
                            <ul class="space-y-2">
                                <li class="flex items-start">
                                    <i class="fas fa-lightning-bolt text-yellow-500 mr-2 mt-1"></i>
                                    <span>Create indexes on frequently queried columns</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-lightning-bolt text-yellow-500 mr-2 mt-1"></i>
                                    <span>Use composite indexes for multi-column queries</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-lightning-bolt text-yellow-500 mr-2 mt-1"></i>
                                    <span>Avoid over-indexing to prevent INSERT/UPDATE overhead</span>
                                </li>
                                <li class="flex items-start">
                                    <i class="fas fa-lightning-bolt text-yellow-500 mr-2 mt-1"></i>
                                    <span>Monitor and maintain index statistics regularly</span>
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">7.2 Query Optimization Techniques</h3>
                <div class="concept-box">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-purple-600">Performance Best Practices</h4>
                            <ul class="space-y-2">
                                <li>• Use EXPLAIN to analyze query execution plans</li>
                                <li>• Avoid SELECT * in production queries</li>
                                <li>• Use appropriate JOIN types (INNER vs OUTER)</li>
                                <li>• Implement query result caching when appropriate</li>
                                <li>• Use LIMIT for large result sets</li>
                                <li>• Optimize WHERE clause conditions</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-red-600">Common Anti-patterns to Avoid</h4>
                            <ul class="space-y-2">
                                <li>• Using functions in WHERE clauses</li>
                                <li>• NOT IN with NULL values</li>
                                <li>• Inefficient subqueries instead of JOINs</li>
                                <li>• Missing foreign key constraints</li>
                                <li>• Lack of error handling in procedures</li>
                                <li>• Hardcoded values instead of parameters</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">7.3 MongoDB Best Practices</h3>
                <div class="concept-box">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-blue-600">Document Design</h4>
                            <ul class="space-y-2">
                                <li>• Embed related data that is accessed together</li>
                                <li>• Use references for large or frequently changing data</li>
                                <li>• Limit document size to 16MB maximum</li>
                                <li>• Design for your specific query patterns</li>
                                <li>• Use meaningful field names and consistent structure</li>
                                <li>• Implement document validation schemas</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-green-600">Performance Optimization</h4>
                            <ul class="space-y-2">
                                <li>• Create appropriate indexes for query patterns</li>
                                <li>• Use aggregation pipeline for complex operations</li>
                                <li>• Implement proper projection to limit returned data</li>
                                <li>• Use connection pooling for better resource management</li>
                                <li>• Monitor slow queries with profiler</li>
                                <li>• Optimize for write-heavy vs read-heavy workloads</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">7.4 Security and Maintenance</h3>
                <div class="concept-box">
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-red-600">Security Practices</h4>
                            <ul class="space-y-2 text-sm">
                                <li>• Implement proper authentication and authorization</li>
                                <li>• Use parameterized queries to prevent SQL injection</li>
                                <li>• Encrypt sensitive data at rest and in transit</li>
                                <li>• Regular security audits and penetration testing</li>
                                <li>• Implement database firewall rules</li>
                                <li>• Monitor for suspicious database activities</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-blue-600">Backup & Recovery</h4>
                            <ul class="space-y-2 text-sm">
                                <li>• Implement automated backup schedules</li>
                                <li>• Test restore procedures regularly</li>
                                <li>• Use point-in-time recovery capabilities</li>
                                <li>• Store backups in multiple locations</li>
                                <li>• Document disaster recovery procedures</li>
                                <li>• Monitor backup completion and integrity</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="text-lg font-semibold mb-3 text-green-600">Monitoring & Maintenance</h4>
                            <ul class="space-y-2 text-sm">
                                <li>• Set up performance monitoring alerts</li>
                                <li>• Regular database maintenance tasks</li>
                                <li>• Update statistics and rebuild indexes</li>
                                <li>• Monitor disk space and growth patterns</li>
                                <li>• Review and optimize slow queries</li>
                                <li>• Keep database software updated</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Section 8: Summary -->
        <section id="summary">
            <div class="section-header">
                <h2 class="text-3xl font-bold"><i class="fas fa-clipboard-check mr-3"></i>8. Summary and Quick Reference</h2>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">8.1 SQL Command Quick Reference</h3>
                <div class="concept-box">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        <div>
                            <h4 class="font-semibold mb-2 text-blue-600">DDL Commands</h4>
                            <div class="code-block text-xs">CREATE TABLE table_name (
    column1 datatype constraints,
    column2 datatype constraints,
    CONSTRAINT pk_name PRIMARY KEY (column1),
    CONSTRAINT fk_name FOREIGN KEY (column2) 
        REFERENCES other_table(column)
);

ALTER TABLE table_name 
ADD COLUMN new_column datatype;

DROP TABLE table_name;

CREATE INDEX idx_name 
ON table_name (column1, column2);

CREATE VIEW view_name AS
SELECT columns FROM table WHERE condition;</div>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2 text-green-600">DML Commands</h4>
                            <div class="code-block text-xs">INSERT INTO table_name (col1, col2) 
VALUES (val1, val2);

UPDATE table_name 
SET column1 = value1 
WHERE condition;

DELETE FROM table_name 
WHERE condition;

SELECT columns 
FROM table1 t1
JOIN table2 t2 ON t1.id = t2.id
WHERE condition
GROUP BY columns
HAVING condition
ORDER BY columns
LIMIT n;</div>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2 text-purple-600">Advanced SQL</h4>
                            <div class="code-block text-xs">-- Window Functions
SELECT column1,
    ROW_NUMBER() OVER (ORDER BY column2) as rn,
    RANK() OVER (PARTITION BY col3 ORDER BY col2) as rnk
FROM table_name;

-- CTE
WITH cte_name AS (
    SELECT columns FROM table WHERE condition
)
SELECT * FROM cte_name;

-- Subqueries
SELECT * FROM table1 
WHERE column1 IN (
    SELECT column1 FROM table2 WHERE condition
);</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">8.2 MongoDB Command Quick Reference</h3>
                <div class="concept-box">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <h4 class="font-semibold mb-2 text-blue-600">CRUD Operations</h4>
                            <div class="code-block text-xs">// Insert
db.collection.insertOne({field: value});
db.collection.insertMany([{}, {}, {}]);

// Find
db.collection.find({field: value});
db.collection.findOne({field: value});

// Update
db.collection.updateOne(
    {filter}, 
    {$set: {field: newValue}}
);
db.collection.updateMany(filter, update);

// Delete
db.collection.deleteOne({filter});
db.collection.deleteMany({filter});</div>
                        </div>
                        <div>
                            <h4 class="font-semibold mb-2 text-green-600">Aggregation & Indexing</h4>
                            <div class="code-block text-xs">// Aggregation
db.collection.aggregate([
    {$match: {field: value}},
    {$group: {_id: "$field", count: {$sum: 1}}},
    {$sort: {count: -1}},
    {$limit: 10}
]);

// Indexing
db.collection.createIndex({field: 1});
db.collection.createIndex({field1: 1, field2: -1});
db.collection.getIndexes();
db.collection.dropIndex({field: 1});</div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">8.3 PL/SQL Structure Template</h3>
                <div class="concept-box">
                    <div class="code-block">DELIMITER //

CREATE PROCEDURE procedure_name(
    IN param1 datatype,
    OUT param2 datatype,
    INOUT param3 datatype
)
BEGIN
    -- Variable declarations
    DECLARE variable_name datatype DEFAULT value;
    DECLARE done INT DEFAULT FALSE;
    
    -- Cursor declaration
    DECLARE cursor_name CURSOR FOR 
        SELECT columns FROM table WHERE condition;
    
    -- Exception handlers
    DECLARE CONTINUE HANDLER FOR NOT FOUND SET done = TRUE;
    DECLARE EXIT HANDLER FOR SQLEXCEPTION
    BEGIN
        ROLLBACK;
        RESIGNAL;
    END;
    
    -- Main logic
    START TRANSACTION;
    
    -- Cursor operations
    OPEN cursor_name;
    
    cursor_loop: LOOP
        FETCH cursor_name INTO variables;
        
        IF done THEN
            LEAVE cursor_loop;
        END IF;
        
        -- Process each row
        
    END LOOP;
    
    CLOSE cursor_name;
    
    COMMIT;
    
END //

DELIMITER ;</div>
                </div>
            </div>

            <div class="subsection">
                <h3 class="text-2xl font-semibold mb-4 text-gray-800">8.4 Performance Checklist</h3>
                <div class="concept-box">
                    <div class="bg-gradient-to-r from-blue-50 to-green-50 p-6 rounded-lg">
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                            <div>
                                <h4 class="font-semibold mb-3 text-blue-700">SQL Database Performance</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" disabled>
                                        <span class="text-sm">Proper indexing strategy implemented</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" disabled>
                                        <span class="text-sm">Query execution plans analyzed</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" disabled>
                                        <span class="text-sm">Database statistics updated</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" disabled>
                                        <span class="text-sm">Stored procedures optimized</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" disabled>
                                        <span class="text-sm">Foreign key constraints implemented</span>
                                    </label>
                                </div>
                            </div>
                            <div>
                                <h4 class="font-semibold mb-3 text-green-700">MongoDB Performance</h4>
                                <div class="space-y-2">
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" disabled>
                                        <span class="text-sm">Appropriate indexes created</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" disabled>
                                        <span class="text-sm">Document structure optimized</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" disabled>
                                        <span class="text-sm">Aggregation pipelines efficient</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" disabled>
                                        <span class="text-sm">Query profiling enabled</span>
                                    </label>
                                    <label class="flex items-center">
                                        <input type="checkbox" class="mr-2" disabled>
                                        <span class="text-sm">Connection pooling configured</span>
                                    </label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Footer -->
        <footer class="mt-12 py-8 bg-gray-800 text-white rounded-lg">
            <div class="text-center">
                <h3 class="text-xl font-semibold mb-4">
                    <i class="fas fa-database mr-2"></i>
                    Database Management Systems Reference Guide
                </h3>
                <p class="text-gray-300 mb-4">
                    This comprehensive guide covers SQL, PL/SQL, MongoDB, and database design principles with practical examples and best practices.
                </p>
                <div class="flex justify-center space-x-6 text-sm text-gray-400">
                    <span><i class="fas fa-table mr-1"></i>30+ Tables & Collections</span>
                    <span><i class="fas fa-code mr-1"></i>100+ Code Examples</span>
                    <span><i class="fas fa-search mr-1"></i>50+ Queries</span>
                    <span><i class="fas fa-cogs mr-1"></i>20+ Procedures</span>
                </div>
                <div class="mt-4 text-xs text-gray-500">
                    Generated on: <span id="generation-date"></span>
                </div>
            </div>
        </footer>
    </div>

    <script>
        // Set generation date
        document.getElementById('generation-date').textContent = new Date().toLocaleString();
        
        // Smooth scrolling for navigation links
        document.querySelectorAll('.nav-link').forEach(link => {
            link.addEventListener('click', function(e) {
                e.preventDefault();
                const targetId = this.getAttribute('href');
                const targetElement = document.querySelector(targetId);
                if (targetElement) {
                    targetElement.scrollIntoView({
                        behavior: 'smooth',
                        block: 'start'
                    });
                }
            });
        });

        // Print optimization
        window.addEventListener('beforeprint', function() {
            document.body.style.fontSize = '11px';
        });

        window.addEventListener('afterprint', function() {
            document.body.style.fontSize = '';
        });
    </script>
</body>
</html>
